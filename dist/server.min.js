"use strict";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(t,!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var express=require("express"),bodyParser=require("body-parser"),db=require("./db"),app=express();app.use(bodyParser.json());var PORT=process.env.PORT||3e3;app.listen(PORT,function(){console.log("Server is running on port ".concat(PORT))}),app.post("/orders",function(r,o){var e=r.body,t=e.order_date,n=e.customer_id,i=e.shipping_contact_mech_id,s=e.billing_contact_mech_id,c=e.order_items;if(!(t&&n&&i&&s&&c&&Array.isArray(c)))return o.status(400).json({error:"Invalid input data"});db.query("INSERT INTO Order_Header (order_date, customer_id, shipping_contact_mech_id, billing_contact_mech_id) VALUES (?, ?, ?, ?)",[t,n,i,s],function(r,e){if(r)return o.status(500).json({error:"Database error while creating order header"});var t=e.insertId,n=c.map(function(r){return[t,r.product_id,r.quantity,r.status]});db.query("INSERT INTO Order_Item (order_id, product_id, quantity, status) VALUES ?",[n],function(r){if(r)return o.status(500).json({error:"Database error while creating order items"});o.status(201).json({message:"Order created successfully",orderId:t})})})}),app.get("/orders/:order_id",function(r,n){var o=r.params.order_id;db.query('\n        SELECT \n            oh.order_id,\n            oh.order_date AS "date",\n            c.first_name AS "firstName",\n            c.last_name AS "lastName",\n            CONCAT(cm1.street_address,\' \', cm1.city,\' \', cm1.state,\' \', cm1.postal_code) AS "shippingAddress",\n            cm1.phone_number AS "shippingContact",\n            cm1.email AS "shippingEmail",\n            CONCAT(cm2.street_address,\' \',cm2.city,\' \', cm2.state,\' \',cm2.postal_code) AS "billingAddress"\n        FROM \n            Order_Header AS oh \n        JOIN \n            Customer AS c ON oh.customer_id = c.customer_id \n        JOIN \n            Contact_Mech AS cm1 ON oh.shipping_contact_mech_id = cm1.contact_mech_id \n        JOIN \n            Contact_Mech AS cm2 ON oh.billing_contact_mech_id = cm2.contact_mech_id \n        WHERE \n            oh.order_id = ?',[o],function(r,e){if(r)return n.status(500).json({error:"Database error while retrieving order details"});if(0===e.length)return n.status(404).json({error:"Order not found"});var t=e[0];db.query("\n            SELECT \n                oi.order_item_seq_id,\n                oi.order_id,\n                oi.product_id,\n                oi.quantity,\n                oi.status,\n                p.product_name,\n                p.color,\n                p.size\n            FROM \n                Order_Item AS oi \n            INNER JOIN \n                Product AS p ON oi.product_id = p.product_id \n            WHERE \n                oi.order_id = ?",[o],function(r,e){if(r)return n.status(500).json({error:"Database error while retrieving order items"});n.status(200).json(_objectSpread({},t,{items:e}))})})});
//# sourceMappingURL=server.min.js.map
